<p-growl [value]="msgs"></p-growl>
<div class="col-md-12">
    <h2 class="col-md-4"><strong>Bank Reconciliations</strong></h2>
</div>
<div class="col-md-12">
    <div class="col-lg-3 col-md-4 col-sm-4 form-group">
        <label for="filterLocationId">Location:&nbsp;</label>
        <p-dropdown [options]="locations" (onChange)="loadReconciles()" [(ngModel)]="filterLocation" [filter]="true" [lazy]="false" placeholder="Select Location"></p-dropdown>
        <button class="btn-xs btn-primary" (click)="filterLocation=''"><i class="fa fa-close"></i></button>
    </div>
    <div class="col-lg-3 col-md-5 col-sm-5 form-group">
        <label for="filterMerchantId">MID:&nbsp;</label>
        <input type="text" [(ngModel)]="filterMerchantId"  name="filterMerchantId" id="filterMerchantId" placeholder="Merchant ID"/>
    </div>   
    <div class="visible-sm  visible-md col-sm-3">&nbsp;</div>
    <div class="col-lg-6 col-md-12 col-sm-12 form-group">
            <p-selectButton [disabled]="filterMerchantId === '' && filterLocation === ''" [options]="types" [(ngModel)]="type" (onChange)="loadReconciles()"></p-selectButton>
    </div>
    <div class="col-xs-12">
        <label class="col-xs-1" style="height:35px;margin-top:10px;">From:  </label>
        <p-calendar styleClass="col-xs-11 col-md-3" [(ngModel)]="fromDate" [showIcon]="true" [showOnFocus]="false"></p-calendar>
        <div style="clear:both" class="visible-sm visible-xs"></div>
        <label class="col-xs-1" style="height:35px;margin-top:10px;">To:  </label>
        <p-calendar styleClass="col-xs-11 col-md-3" [(ngModel)]="toDate" [showIcon]="true" [showOnFocus]="false"></p-calendar>
        <div style="clear:both" class="visible-sm visible-xs"></div>
        <div class="col-xs-3">
            <button class="btn btn-primary" [disabled]="filterMerchantId === '' && filterLocation === ''" (click)="filter()">Filter</button>
        </div>
    </div> 
    <div style="clear:both">&nbsp;</div>
    <p-dataTable *ngIf="type2==2" [immutable]="false" (onPage)="onPage($event)" (onFilter)="onFilter($event)" (onSort)="onSort($event)" scrollable="true" scrollHeight="700px" [pageLinks]="5" [value]="matches" tableStyleClass="table-striped pull-right borderTable" [paginator]="true" [rows]="15" [globalFilter]="gb">
        <p-column field="bankDate" sortable="true" styleClass="col-md-2">
            <template pTemplate="header">
                Bank Date
            </template>
            <template let-reconcile="rowData" pTemplate="body">
                {{reconcile.bankDate | moment: 'format': 'MM/DD/YYYY' }}
            </template>
        </p-column>
        <p-column field="reconcile.bankDepositAmount" sortable="true" styleClass="col-md-2">
            <template pTemplate="header">
                Amount
            </template>
            <template let-reconcile="rowData" pTemplate="body">
                {{reconcile.bankDepositAmount | currency:'USD':true}}
            </template>
        </p-column>
        <p-column field="accountNumber" header="Account" sortable="true" styleClass="col-md-1"></p-column>
        <p-column field="bankCustomerRef" header="Customer Ref" sortable="true" styleClass="col-md-2"></p-column>
    </p-dataTable>  
    <table class="table table-condensed table-striped col-md-12" *ngIf="type2==3">
         <tr>
             <th>Source</th>
             <th>Region</th>
             <th>Location</th>
             <th>Date</th>
             <th>Total</th>
         </tr>
         <ng-container *ngFor="let reconcile of matches">
             <tr>
                 <td>DCR</td>
                 <td>{{reconcile.dcrData.regionNum}}</td>
                 <td>{{reconcile.dcrLocation}}</td>
                 <td>{{reconcile.dcrEntryDate | moment: 'format': 'MM/DD/YYYY'}}</td>
                 <td>{{reconcile.dcrDepositAmount | currency:'USD':true}}</td>
             </tr>
         </ng-container>
    </table>
    <table class="table table-condensed table-striped col-md-12" *ngIf="type2==1">
        <tr>
            <th>Source</th>
            <th>Deposit ID</th>
            <th>Deposit Slip</th>
            <th>Bank Bag</th>
            <th>Location</th>
            <th>Date</th>
            <th>Days Between</th>
            <th>Amount</th>
        </tr>
        <ng-container *ngFor="let reconcile of matches">
            <tr>
                <td>DCR</td>
                <td>{{reconcile.arpdcrCashDepositID}}</td>
                <td>{{reconcile.dcrCashDeposit.strDepositSlipSerialNo}}</td>
                <td>{{reconcile.dcrCashDeposit.strBankBag}}</td>
                <td>{{reconcile.locationID}}</td>
                <td>{{reconcile.dcrEntryDate | moment: 'format': 'MM/DD/YYYY'}}</td>
                <td></td>
                <td>{{reconcile.dcrDepositAmount | currency:'USD':true}}</td>
            </tr>
            <tr *ngIf="reconcile.bankTransaction">
                <td style="padding-left:20px"><img src="/app/images/child_arrow.svg" style="width:20px;position:relative;top:-8px;left:-5px" />Cash Deposit</td>
                <td>{{reconcile.bankTransactionId}};</td>
                <td><strong class="small">Bank Account Number:&nbsp;&nbsp;</strong>{{reconcile.accountNumber}}</td>
                <td><strong class="small">Bank Customer Ref:&nbsp;&nbsp;</strong>{{reconcile.bankCustomerRef}}</td>
                <td></td>
                <td>{{reconcile.bankDate | moment: 'format': 'MM/DD/YYYY'}}</td>
                <td>{{daysBetween(reconcile.dcrEntryDate, reconcile.bankDate)}}</td>
                <td>{{reconcile.bankDepositAmount | currency:'USD':true}}</td>
            </tr>
            <tr *ngIf="!reconcile.bankTransaction">
                <td colspan="7">&nbsp;</td>
            </tr>
        </ng-container>
    </table>
</div>
